## Express

Express에서 가장 많이 사용되는 요청 방식은 GET, LISTEN, POST, PUT, DELETE이다.

예를들어 naver의 로그인 화면의 폼에서 요청하고있는 메소드는 POST이다.

POST는 사용자가 입력한 정보를 서버로 보내는 메소드이다.

이러한 메소드들을 사용하기 편리하게 하기위해 Thunder Client 확장을 설치하면 편하다.

### 라우트 파라미터

- 특정 조건을 지정할 때 라우팅 코드에서 요청 URL 뒤에 :를 붙인 후 그 뒤에 변수를 작성하는 방식으로 사용된다.
  * /요청 URL/:id
- 요청할 때는 욫어 URL뒤에 조건 값을 지정한다.
  * ex) 연락처 정보 중 아이디가 '1'인 것을 가져오려면 /contacts/1
 
위 메소드들을 특정 파리미터 값을 조정하는 방식으로 사용하면 다음과 같다.

```javascript
const express = require("express");
const app = express();

app.get("/", (req,res) =>{
    res.send("Hello, Node!");
});

//연락처 가져오기
app.get("/contacts", (req, res) => {
    res.send("Contacts Page");
})

// post, put, delete >> 가장 많이 사용되는 요청 방식

//특정 연락처 1개 가져오기
app.get("/contacts/:id", (req,res) =>{
    res.send(`View Contact for ID: ${req.params.id}`)
})

// 새 연락처 추가하기
app.post("/contacts", (req, res) =>{
    res.send("Create Contacts");
})

app.put("/contacts/:id", (req, res) =>{
    res.send(`Update Contact for ID: ${req.params.id}`)
})

app.delete("/contacts/:id", (req, res) =>{
    res.send(`Delete Contact for ID: ${req.params.id}`)
})

app.listen(3000, () => {
    console.log("서버 실행 중");
});
```

Thunder Client를 이용해 GET, PUT, POST, DELETE를 확인해보면 다음과 같다.

![image](https://github.com/Jaeboong/BE-Node.js/assets/158824294/1ef23bdc-75e4-4488-92e5-ce600306b711)

위는 DELETE의 예제이고 GET, PUT, POST도 잘 작동한다.

그리고 위 코드에서 사용한 req.params는 URL 뒤에 라우트 파라미터가 포함되어 있을 경우 파라미터의 정보를 담고있는 객체 속성이다.

익스프레스 요청 객체 속성들은 다음과 같다.

![image](https://github.com/Jaeboong/BE-Node.js/assets/158824294/9102de75-8881-4a85-90d3-706f3140f6a4)

익스프레드 응답 객체 함수는 다음과 같다.

![image](https://github.com/Jaeboong/BE-Node.js/assets/158824294/1135ac96-6e08-4f67-be14-0649791f9bef)

### 미들웨어

- 미들웨어란?
  * 클라이언트의 요청과 서버의 응답, 중간에서 필요한 기능들을 처리해주는 함수를 가리킨다.

- 미들웨어의 역할
  * 요청 전처리
  * 라우팅 처리
  * 응답 처리
 
미들웨어인 라우트를 사용하면 위와 같은 코드를 더욱 간결하게 정리할 수 있다.

우선 라우팅 코드를 사용하면 다음과 같다.

```javascript
const router = express.Router();

router.route("/").get((req,res) =>{
    res.send("Hello, Node!");
});

router.route("/")
.get((req, res)=>{
    res.send("Contacts Page");
})
.post((req, res) =>{
    res.send("Create Contacts")
});

router.route("/:id")
.get((req,res) =>{
    res.send(`View Contact for ID: ${req.params.id}`)
})
.put((req, res) =>{
    res.send(`Update Contact for ID: ${req.params.id}`)
})
.delete((req, res) =>{
    res.send(`Delete Contact for ID: ${req.params.id}`)
});
```

router라는 이름으로 Router()를 호출하는 객체가 생성되었고

router.route("/").get().post().delete(); 와 같은 형식으로 코드들이 나열되어있다.

코드가 간결하게 정리되었고 이 라우팅에 해당하는 코드들을 모듈화시켜 분리하면

- app.js

```javascript
const express = require("express");
const app = express();

app.use("/users", require("./routes/contactRoutes"));

app.listen(3000, () => {
    console.log("서버 실행 중");
});
```

- contactRoutes.js

```javascript
const express = require("express");
const router = express.Router();

router.route("/").get((req,res) =>{
    res.send("Hello, Node!");
});

router.route("/")
.get((req, res)=>{
    res.send("Contacts Page");
})
.post((req, res) =>{
    res.send("Create Contacts")
});

router.route("/:id")
.get((req,res) =>{
    res.send(`View Contact for ID: ${req.params.id}`)
})
.put((req, res) =>{
    res.send(`Update Contact for ID: ${req.params.id}`)
})
.delete((req, res) =>{
    res.send(`Delete Contact for ID: ${req.params.id}`)
});

module.exports = router;
```

이렇게 스타트 파일이 훨씬 깔끔하게 정리할 수 있다.

결과는 라우터를 사용하지 않았을때와 똑같다.

### 바디파서

- 서버로 요청을 바낼 때 요청 본문에 담긴 것을 파싱하는 미들웨어
- 바디파서는 요청 본문에 어떤 유형의 자료를 포함하는가에 따라 사용하는 함수가 달라진다.
- JSON 형식이나 urlencoded형식을 처리할 경우 익스프레스 내장 함수를 사용한다.

이중 JSON 형식을 사용해 볼 것이다.

```javascript
app.use(express.json());
app.use(express.urlencoded({extended: true}));
```

위와같이 바디파서를 사용한다고 선언을 해준 후 바디 부분에 json 형식으로 사용한 코드를 콘솔창에 출력시키면 다음과 같다.

```javascript
.post((req, res) =>{
    console.log(req.body);
    const {name, email, phone} = req.body;
    if(!name|| !email || !phone){
        return res.send("필수 값이 입력되지 않았습니다!");
    }

    res.send("Create Contacts")
});
```

해당 코드는 json형태로 사용한

```json
{
  "name": "Kim",
  "email": "cbkjh0225@naver.com",
  "phone": "010-3541-7257"
}
```

중 속성 name, email, phone중 하나라도 없으면 "필수 값이 입력되지 않았습니다" 라고 출력하며 
json으로 작성된 데이터를 콘솔창에 출력시킨다.
